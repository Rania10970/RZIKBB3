<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">



<html xmlns="http://www.w3.org/1999/xhtml" xmlns:widget="http://www.netvibes.com/ns/">


<head>

    <!-- Application Metas -->
    <title>Title of the App</title>
    <meta name="author" content="John Doe" />
    <meta name="description" content="A descriptive description" />

    <!-- Application Standalone emulation files -->
    <link rel="stylesheet" type="text/css" href="http://uwa.netvibes.com/lib/c/UWA/assets/css/standalone.css" />
    <script type="text/javascript" src="http://uwa.netvibes.com/lib/c/UWA/js/UWA_Standalone_Alone.js"></script>

    <!-- Application JavaScript Source -->
    <script type="text/javascript">
        (function () {
            'use strict';
            require(
                [
                    'DS/PlatformAPI/PlatformAPI',
                    'DS/DataDragAndDrop/DataDragAndDrop',
                ],
                function (PlatformAPI, DataDragAndDrop) {

                    var platformId;
                    var theConnectedUser;
                    var theSecurityContext;
                    var myViewer;
                    var theApplicativeURI;
                    var theProto;
                    var modeWidget;
                    var engeneringServer;

                    var user = PlatformAPI.getUser();
                    if (user && user.login) {
                        console.log("user")
                        theConnectedUser = user.login;
                     
                    }

                    var myWidget = {
                        onLoad: function () {

                            // Here we update the content of the widget body.
                            widget.setBody('Hello World!');
                            widget.createElement('a', {
                                text: 'My link',
                                events: {
                                    click: function () { console.log(user) }
                                }
                            }).inject(widget.body);

                            var maindiv = widget.createElement('div', {
                                id: 'mainDiv'
                            }).inject(widget.body)
                            
                            
                            var table = widget.createElement('table', {
                                border: "1",
                                id: 'kids'
                            }).inject(maindiv)

                            var tr1 = widget.createElement('tr').inject(table)
                            var tr2 = widget.createElement('tr').inject(table)

                            var th1 = widget.createElement('th', {
                                html: 'Désignation'
                            }).inject(tr1)

                            var th2 = widget.createElement('th', {
                                html: 'Quantité'
                            }).inject(tr1)

                            var th3 = widget.createElement('th', {
                                html: 'Série'
                            }).inject(tr1)

                            var th4 = widget.createElement('th', {


                            }).inject(tr1)


                            var th5 = widget.createElement('th',{
                             

                            }).inject(tr1)

                            var th6 = widget.createElement('th',{
                             

                            }).inject(tr1)


                            var i = 0;

                            var td1 = widget.createElement('td', {
                                id: 'td1'
                            }).inject(tr2)
                            var td2 = widget.createElement('td').inject(tr2)
                            var td3 = widget.createElement('td').inject(tr2)
                            var td4 = widget.createElement('td').inject(tr2)


                            var input1 = widget.createElement('input', {
                                id: 'input1_'+i
                            }).inject(td1);
                            var input2 = widget.createElement('input',{
                                id: 'input2_'+i
                            }).inject(td2);
                            var input3 = widget.createElement('input',{
                                id: 'input3_'+i
                            }).inject(td3);


                            var add = function addKid() {
                                console.log("in ADD ================")
                                if (i < 5) {
                                    i++;
                                    var newRow = widget.createElement('tr', {
                                        id: 'tr_' + i
                                    }).inject(table);

                                    var addtd1 = widget.createElement('td').inject(newRow)
                                    var addtd2 = widget.createElement('td').inject(newRow)
                                    var addtd3 = widget.createElement('td').inject(newRow)
                                    var addtd4 = widget.createElement('td').inject(newRow)


                                    var add1 = widget.createElement('input',{
                                        id: 'input1_'+i
                                    }).inject(addtd1);
                                    var add2 = widget.createElement('input',{
                                        id: 'input2_'+i
                                    }).inject(addtd2);
                                    var add3 = widget.createElement('input',{
                                        id: 'input3_'+i
                                    }).inject(addtd3);

                                    var add4 = new UWA.Controls.Input.Button({
                                        value: "-",
                                        attributes: {
                                            id: 'susBtn_' + i
                                        },
                                        events: {
                                            onClick: function (e) {
                                                console.log(e.target.getParents())
                                                e.target.getParents()[1].remove()
                                                i--

                                            },

                                        },

                                    }).inject(addtd4);


                                }
                            }


                            var addBtn = new UWA.Controls.Input.Button({
                                value: "+",
                                events: {
                                    onClick: add,
                                },
                                id: 'add_kid()'
                            }).inject(th4);


                            var sendBtn = new UWA.Controls.Input.Button({
                                        value: "send",
                                        attributes: {
                                            id: 'submit'
                                        },
                                        events: {
                                            onClick: function(){
                                                console.log("submit button ")
                                                

                                            },
                        
                                        },
                                        
                                    }).inject(th5);


                                    var prefs = new UWA.Controls.Form({
                                    fields: [

                                    {
                                        type: "list",
                                        name: "My List",
                                        label: "Choose Tenant",
                                        value: "Value1",
                                        options: [
                                            {
                                                label: "Tenant 1",
                                                value: "Value1"
                                            },
                                            {
                                                label: "Tenant 2",
                                                value: "Value2"
                                            },
                                           
                                        ],
                                        value: "-Other- "
                                    }
                                    ],
                                   events: {
                                        onChange: function(callback, name, value) {

                                        },

                                        onSubmit: function(event, values) {
                                            cosole.log("send evnet")

                                        }
                                    }
                                    }) .inject(th6);





                            var theInput = document.getElementById('input1');
                            console.log(theInput)


                            DataDragAndDrop.droppable(maindiv, {
                                drop: function (data) {
                                    console.log(data)
                                    var jsondata = JSON.parse(data)
                                    console.log(jsondata["data"])
                                    for(object in jsondata['data']['items']){
                                        addKid();
                                        var displayName = document.getElementById('input1_'+i);
                                        var objectType = document.getElementById('input2_'+i);
                                        var objectId = document.getElementById('input3_'+i);
                                        displayName.value = object['displayName']
                                        objectType.value = object['objectType']
                                        objectId.value = object['objectId']
                                    }
                                    
                          




                                },

                                enter: function () {
                                    console.log("drop1")
                                },
                                over: function () {
                                    console.log("drop2")
                                },
                                leave: function () {
                                    console.log("drop3")
                                }
                            });






                        },




                    };
                    console.log("9GAG");

                    console.log(widget.id)
                    widget.addEvent('onLoad', myWidget.onLoad);
                    widget.addEvent('onRefresh', myWidget.onRefresh);
                    widget.addEvent('onResize', myWidget.onResize);
                });

        }());
    </script>
</head>

<body>
    <p>Loading...</p>
</body>

</html>