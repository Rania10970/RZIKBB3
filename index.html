<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">



<html xmlns="http://www.w3.org/1999/xhtml" xmlns:widget="http://www.netvibes.com/ns/">


<head>

    <!-- Application Metas -->
    <title>Title of the App</title>
    <meta name="author" content="John Doe" />
    <meta name="description" content="A descriptive description" />
    <script src="https: //ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Applicatfion Standalone emulation files -->
    <link rel="stylesheet" type="text/css" href="http://uwa.netvibes.com/lib/c/UWA/assets/css/standalone.css" />
    <link rel="stylesheet" href="https: //raw.githubusercontent.com/Rania10970/RZIKBB3/main/index_style.css">
    <script type="text/javascript" src="http://uwa.netvibes.com/lib/c/UWA/js/UWA_Standalone_Alone.js"></script>
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> -->

    <widget:preferences>
        <widget:preference type="text" name="taskID" label="Task ID" defaultValue=""></widget:preference>
        <widget:preference type="text" name="taskName" label="Name Task (create action)" defaultValue="">
        </widget:preference>
        <widget:preference type="list" name="action" label="Possible actions" defaultValue="list">
            <widget:option value="create" label="Create a Task"></widget:option>
            <widget:option value="expand" label="Expand a Task"></widget:option>
            <widget:option value="delete" label="Delete a Task"></widget:option>
            <widget:option value="update" label="Update a Task"></widget:option>
            <widget:option value="deleteall" label="Delete Tasks"></widget:option>
            <widget:option value="promote" label="Promote a Task"></widget:option>
            <widget:option value="demote" label="Demote a Task"></widget:option>
            <widget:option value="root" label="List Root Tasks"></widget:option>
            <widget:option value="list" label="List Tasks"></widget:option>
            <widget:option value="listowner" label="List Tasks for Connected Person as Owner"></widget:option>
            <widget:option value="expandall" label="Expand Tasks"></widget:option>
        </widget:preference>
        <widget:preference type="text" name="ctx" label="Role.Organization.Collaborative Space"
            defaultValue="VPLMProjectLeader.MyCompany.3DS Private Collab Space"></widget:preference>
    </widget:preferences>
 <style>
    tbody tr:nth-child(odd) {
    background-color: #ff33cc;
    }

    tbody tr:nth-child(even) {
    background-color: #e495e4;
    }

    
 tr  {
    background-color: midnightblue;
    color: #fff;
    text-align: left;
}

    table {
        border-collapse: collapse;
    min-width: 200px;
    width: auto;
    box-shadow: 0 5px 50px rgba(0,0,0,0.15);
    cursor: pointer;
    margin: 50px auto;
    border: 2px solid midnightblue;
    /* border: 1px solid #ddd;  */
    
    }

    th, td,input {
    padding: 15px 20px;
}

tr, td, th,input{
    border: 1px solid #ddd;
}

 tr:nth-child(even){
    background-color: #f3f3f3;
}


 </style>
    <!-- Application JavaScript Source -->
    <script type="text/javascript">
        (function () {
            'use strict';
            require(
                [
                    'DS/PlatformAPI/PlatformAPI',
                    'DS/DataDragAndDrop/DataDragAndDrop',
                    "DS/WAFData/WAFData",
                    "DS/UWPClientCode/Navigation",
                    "DS/UWPClientCode/Bootstrap",
                   //"DS/DataGridView/DataGridView",
                    // "DS/Windows/ImmersiveFrame",
                     // "DS/Tests_DataGridView/spec/Tests_DataGridView_Utils"

                ],
                function (PlatformAPI, DataDragAndDrop, WAFWAF, navigation, Bootstrap) {
                    var list = new Array();
                    var pathProc = 'https://r1132100565133-eu1-space.3dexperience.3ds.com/enovia/resources/v1/application/CSRF';
                    var pathProc1 = 'https://r1132100565133-eu1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dseng/dseng:EngItem'
                    var myWidget = {
                        onLoad: function () {
                            console.log("=========================5" + JSON.stringify(UWA.Controls))

                     
                            var btn = new UWA.Controls.Input.Button({
                                value: 'Export',
                                id: 'btn'
                            }).inject(widget.body);
                            console.log(btn)
                      


                          

                            function postcsrf(csrf) {
                                var bodyRequest = {
                                    "items": [
                                        {
                                            "attributes": {
                                                "title": "My-hello-test",
                                                "description": "My description"
                                            }
                                        }]
                                };
                                WAFWAF.authenticatedRequest(pathProc1, {
                                    method: "POST",
                                    type: 'json',
                                    data: JSON.stringify(bodyRequest),
                                    headers: {
                                        'SecurityContext': 'VPLMProjectLeader.Company Name.Intertenats',
                                        'Content-Type': 'application/json',
                                        'ENO_CSRF_TOKEN': csrf

                                    },


                                    onComplete: function (backendresponse, responseheaders) {
                                        console.log("========================================POSTCOmplete")
                                        console.log(backendresponse)
                                    },
                                    onFailure: function (error, backendresponse, response_hdrs) {
                                        console.log("========================================Posterror")
                                        console.log(error)

                                    }
                                });




                            }













                            var maindiv = widget.createElement('div', {
                                id: 'mainDiv'

                            }).inject(widget.body)

                            



                            // mainDiv.setStyles({ "display": "flex", "flex-wrap": "wrap", "background-color": "aqua" })


                            var table = widget.createElement('table', {
                                border: "1",
                                id: 'kids',
                                'class': ".table-striped"
                            }).inject(maindiv)

                            //table.setStyles({
                             //   " border-collapse": "collapse", "min-width": "400px", "box-shadow": "0 5px 50px rgba(0,0,0,0.15)",
                              //  "cursor": "pointer", "border": "2px solid midnightblue"
                           // })


                            var tr1 = widget.createElement('tr', {

                                id: 'kids1',
                            }).inject(table)
                          /*  tr1.setStyles({
                                "background-color": " midnightblue", "color": "#fff", "text-align": "left", "border": "1px solid #ddd"

                            })*/

                            var th1 = widget.createElement('td', {
                                id: 'th1',
                                html: 'displayName'
                            }).inject(tr1)
                            

                            var th2 = widget.createElement('td', {
                                id: 'th2',
                                html: 'objectType'
                            }).inject(tr1)
                           

                            var th3 = widget.createElement('td', {
                                id: 'th3',
                                html: 'objectId'
                            }).inject(tr1)
                           

                            var th4 = widget.createElement('td', {
                                id: 'th4',
                                html: 'Revision'


                            }).inject(tr1)
                            


                            var th5 = widget.createElement('td', {
                                id: 'th5',
                                html: 'State'


                            }).inject(tr1)
                            

                            var th6 = widget.createElement('td', {
                                id: 'th6',
                                html: 'collabspace'


                            }
                            ).inject(tr1)


                         



                            var i = 0;






                            //var sendBtn = new UWA.Controls.Input.Button({
                            //  value: "send",
                            //  emphasize: "success",
                            // disabled: true,
                            // styles: {
                            //  'position': 'absolute',
                            // 'right': '20px',

                            //  },
                            // attributes: {
                            //    id: 'submit'
                            // },
                            //events: {
                            // onClick: function () {
                            //  console.log("submit button ")
                            //  WAFWAF.authenticatedRequest(pathProc, {
                            //    method: "GET",
                            //  headers: {
                            //    'SecurityContext': 'VPLMProjectLeader.Company Name.Intertenats'
                            //  },
                            // onComplete: function (backendresponse, responseheaders) {
                            //  console.log("========================================GETCOMPLETE")
                            // console.log(backendresponse)
                            // var jsondata = JSON.parse(backendresponse)
                            // console.log(jsondata)
                            // var csrf = jsondata['csrf']['value']
                            //  console.log(csrf)
                            //  postcsrf(csrf)


                            //   },
                            // onFailure: function (error, backendresponse, response_hdrs) {
                            //   console.log("========================================GETERROR")
                            //  console.log(error)

                            // }
                            //  });



                            // },

                            //},

                            // }).inject(th5);





                            var theInput = document.getElementById('input1');
                            console.log(theInput)




                            function createNewEntry() {
                                console.log("in ADD ================")
                                i++;
                                var newRow = widget.createElement('tr', {
                                    id: 'tr_' + i
                                }).inject(table);
                                
                              

                                var addtd1 = widget.createElement('td', {
                                    id: 'td1',
                                }
                                ).inject(newRow)
                               


                                var addtd2 = widget.createElement('td', {
                                    id: 'td2',
                                }
                                ).inject(newRow)
                               



                                var addtd3 = widget.createElement('td', {
                                    id: 'td3',
                                }
                                ).inject(newRow)
                               


                                var addtd4 = widget.createElement('td', {
                                    id: 'td4',
                                }).inject(newRow)
                               


                                var addtd5 = widget.createElement('td', {
                                    id: 'td5',
                                }).inject(newRow)
                                


                                var addtd6 = widget.createElement('td', {
                                    id: 'td6',
                                }
                                ).inject(newRow)
                                


                                var addtd7 = widget.createElement('td').inject(newRow)
                                var addtd8 = widget.createElement('td').inject(newRow)


                               var add1 = widget.createElement('input', {
                                    id: 'input1_' + i
                                }).inject(addtd1);


                                var add2 = widget.createElement('input', {
                                    id: 'input2_' + i
                                }).inject(addtd2);


                                var add3 = widget.createElement('input', {
                                    id: 'input3_' + i
                                }).inject(addtd3);

                                var add4 = widget.createElement('input', {
                                    id: 'input4_' + i
                                }).inject(addtd4);


                                var add5 = widget.createElement('input', {
                                    id: 'input5_' + i
                                }).inject(addtd5);



                                var add6 = widget.createElement('input', {
                                    id: 'input6_' + i
                                }).inject(addtd6);


                                var add7 = widget.createElement('input', {
                                    id: 'input7_' + i
                                }).inject(addtd7);

                                var add8 = new UWA.Controls.Input.Button({
                                    value: "-",
                                    attributes: {
                                        id: 'susBtn_' + i
                                    },
                                    events: {
                                        onClick: function (e) {
                                            console.log(e.target.getParents())
                                            e.target.getParents()[1].remove()
                                            i--

                                        },

                                    },

                                }).inject(addtd8);

                            }



                            function getdrop(objectId) {
                                var pathProcdrop = 'https://r1132100565133-eu1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dseng/dseng:EngItem/' + objectId;
                                WAFWAF.authenticatedRequest(pathProcdrop, {
                                    method: "GET",
                                    headers: {
                                        'SecurityContext': 'VPLMProjectLeader.Company Name.Intertenats'
                                    },
                                    onComplete: function (backendresponse, responseheaders) {
                                        console.log("====GETDROP COMPLETE")
                                        console.log(backendresponse)
                                        var jsondata = JSON.parse(backendresponse)
                                        console.log(jsondata)
                                        var objects = jsondata['member']
                                        console.log(objects)

                                        for (var j = 0; j < objects.length; j++) {

                                            // if (objects[j]['id'] == objectId ){console.log ("eror");}
                                            //else {
                                            createNewEntry();
                                            var name = document.getElementById('input1_' + i)
                                            

                                            var type = document.getElementById('input2_' + i)

                                            var id = document.getElementById('input3_' + i)

                                            var revision = document.getElementById('input4_' + i)

                                            var state = document.getElementById('input5_' + i)

                                            var collabspace = document.getElementById('input6_' + i)


                                            //name.value = objects[j]['name'];
                                            
                                            var text = document.createTextNode(objects[j]['name']);
                                            name.appendChild(text)
                                                                                    
                                            type.value = objects[j]['type'];
                                            
                                            id.value = objects[j]['id'];
                                         
                                            revision.value = objects[j]['revision'];
                                           
                                            state.value = objects[j]['state'];
                                         
                                            collabspace.value = objects[j]['collabspace'];
                                          
                                        }



                                        // }




                                    },
                                    onFailure: function (error, backendresponse, response_hdrs) {
                                        console.log("====GETDROP ERROR")
                                        console.log(error)

                                    }
                                });

                            }



                            DataDragAndDrop.droppable(maindiv, {

                                drop: function (data) {

                                    var jsondata = JSON.parse(data)
                                    var objects = jsondata['data']['items']


                                    for (var j = 0; j < objects.length; j++) {


                                        var objectId = objects[j]['objectId']

                                        var result = UWA.Array.detect(list, function (value, index) {

                                            return value == objectId;

                                        })
                                        if (!result) {
                                            list.push(objectId);
                                            getdrop(objectId)

                                        }










                                    }





                                },


                                enter: function () {
                                    console.log("drop1")
                                },
                                over: function () {
                                    console.log("drop2")
                                },
                                leave: function () {
                                    console.log("drop3")
                                },







                            });
                        /*    // DATAGRIDVIEW
                            var mainObject = {
                                data: undefined, // Will contains raw data of nodes
                                model: undefined, // Will contains the TreeDocument object
                                view: undefined, // Will contains the DataGridView object
                                columns: undefined, // Will contains the columns definition
                            };

                            var options = {
                                dataTypeRepresentation: "string",
                                rowNumberByLeafNode: 50,
                                columnNumber: 10,
                                leftPinnedColumnNumber: 1,
                                rightPinnedColumnNumber: 1,
                                treeDepth: 2,
                                numberOfNodesByDepthLevel: 4
                            };

                            DataGridViewUtils.generateTreeDocument(mainObject, options);

                            // Create the DataGridView
                            var myDataGridView = new WUXDataGridView({
                                identifier: "myDataGridViewId",
                                treeDocument: mainObject.model,
                                columns: mainObject.columns,
                                defaultColumnDef: { //Set default settings for columns
                                    width: 150,
                                    minWidth: 40,
                                    editableFlag: true
                                },
                            });

                            var immersiveFrame = new WUXImmersiveFrame({
                                reactToPointerEventsFlag: false
                            });
                            immersiveFrame.setContentInBackgroundLayer(myDataGridView.getContent());

                            immersiveFrame.inject(document.body);
                            myDataGridView.onReady(function () {
                                myDataGridView.ensureNodeModelVisible(myDataGridView.model[100]);
                            });*/

                        

                    


                            // ===============================

                        },

                    };
                    widget.addEvent('onLoad', myWidget.onLoad);
                    widget.addEvent('onRefresh', myWidget.onRefresh);
                    widget.addEvent('onResize', myWidget.onResize);
                });

        }());
    </script>
</head>

<body>
</body>

</html>