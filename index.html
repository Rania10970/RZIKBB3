<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">



<html xmlns="http://www.w3.org/1999/xhtml" xmlns:widget="http://www.netvibes.com/ns/">


<head>

    <!-- Application Metas -->
    <title>Title of the App</title>
    <meta name="author" content="John Doe" />
    <meta name="description" content="A descriptive description" />
    <scriptÂ src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
    <!-- Application Standalone emulation files -->
    <link rel="stylesheet" type="text/css" href="http://uwa.netvibes.com/lib/c/UWA/assets/css/standalone.css" />
    <script type="text/javascript" src="http://uwa.netvibes.com/lib/c/UWA/js/UWA_Standalone_Alone.js"></script>

    <widget:preferences>
	    <widget:preference type="text" name="taskID"          label="Task ID"  defaultValue="" ></widget:preference>
		<widget:preference type="text" name="taskName"          label="Name Task (create action)"  defaultValue="" ></widget:preference>
        <widget:preference type="list" name="action"  label="Possible actions"  defaultValue="list"  >  
			<widget:option value="create" label="Create a Task"></widget:option>
			<widget:option value="expand" label="Expand a Task"></widget:option>
			<widget:option value="delete" label="Delete a Task"></widget:option>
			<widget:option value="update" label="Update a Task"></widget:option>
			<widget:option value="deleteall" label="Delete Tasks"></widget:option>
			<widget:option value="promote" label="Promote a Task"></widget:option>	
            <widget:option value="demote" label="Demote a Task"></widget:option>			
			<widget:option value="root" label="List Root Tasks"></widget:option>
			<widget:option value="list" label="List Tasks"></widget:option>
			<widget:option value="listowner" label="List Tasks for Connected Person as Owner"></widget:option>
			<widget:option value="expandall" label="Expand Tasks"></widget:option>			
		</widget:preference>
        <widget:preference type="text" name="ctx"  label="Role.Organization.Collaborative Space"    defaultValue="VPLMProjectLeader.MyCompany.3DS Private Collab Space" ></widget:preference>		
    </widget:preferences>

    <!-- Application JavaScript Source -->
    <script type="text/javascript">
        (function () {
            'use strict';
            require(
                [
                    'DS/PlatformAPI/PlatformAPI',
                    'DS/DataDragAndDrop/DataDragAndDrop',
                    "DS/WAFData/WAFData",
                    "DS/UWPClientCode/Navigation",
                    "DS/UWPClientCode/Bootstrap"
                    
                ],
                function (PlatformAPI, DataDragAndDrop, WAFWAF,navigation,Bootstrap) {



           
                //var pathProc = 'https://r1132100565133-eu1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dseng/dseng:EngItem/ADF53C23000009F86052259100036C47?$mask=dsmveng:EngItemMask.Common'
                var pathProc='https://r1132100565133-eu1-space.3dexperience.3ds.com/enovia/resources/v1/application/CSRF';
                var pathProc1 = 'https://r1132100565133-eu1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dseng/dseng:EngItem'
                

                    var myWidget = {
                        onLoad: function () {


                            WAFWAF.authenticatedRequest(pathProc, {
                                method: "GET",
                                headers: {
                                    'SecurityContext' : 'VPLMProjectLeader.Company Name.Intertenats'
                                },
                                onComplete: function (backendresponse, responseheaders) {
                                    console.log("========================================")
                                    console.log(backendresponse)
                                },
                                onFailure: function (error, backendresponse, response_hdrs) {
                                    console.log("========================================")
                                    console.log(error)

                                }
                            });

                            var bodyRequest = {
                                                "items": [
                                                    {
                                                    "attributes": {
                                                        "title": "My-hello-test",
                                                        "description": "My description"
                                                        }
                                                }]};
                            WAFWAF.authenticatedRequest(pathProc1, {
                                method: "POST",
                                type : 'json',
                                data: JSON.stringify(bodyRequest) ,
                                headers: {
                                    'SecurityContext' : 'VPLMProjectLeader.Company Name.Intertenats',
                                    'Content-Type': 'application/json',
                                    'ENO_CSRF_TOKEN':'C3F1-BH5L-VE7Z-DO2S-P7PY-UQTT-DVTJ-PL0M'
                                },

                               
                                onComplete: function (backendresponse, responseheaders) {
                                    console.log("========================================")
                                    console.log(backendresponse)
                                },
                                onFailure: function (error, backendresponse, response_hdrs) {
                                    console.log("========================================")
                                    console.log(error)

                                }
                            });





                            // requestHeaders example value: {"Content-Type": "text/html", ...}
                            // Here we update the content of the widget body.

                            var maindiv = widget.createElement('div', {
                            id: 'mainDiv'
                        }).inject(widget.body)

                            var table = widget.createElement('table', {
                            border: "1",
                            id: 'kids'
                        }).inject(maindiv)
                            var tr1 = widget.createElement('tr').inject(table)

                            var th1 = widget.createElement('td', {
                            html: 'displayName'
                        }).inject(tr1)

                            var th2 = widget.createElement('td', {
                            html: 'objectType'
                        }).inject(tr1)

                            var th3 = widget.createElement('td', {
                            html: 'objectId'
                        }).inject(tr1)

                            var th4 = widget.createElement('td', {


                        }).inject(tr1)


                            var th5 = widget.createElement('td').inject(tr1)

                            var th6 = widget.createElement('td').inject(tr1)






                            var i = 0;



                        var addBtn = new UWA.Controls.Input.Button({
                            value: "+",
                            events: {
                                onClick: function () {
                                    createNewEntry();
                                },
                            },
                            id: 'add_kid()'
                        }).inject(th4);


                        var sendBtn = new UWA.Controls.Input.Button({
                            value: "send",
                            attributes: {
                                id: 'submit'
                            },
                            events: {
                                onClick: function () {
                                    console.log("submit button ")


                                },

                            },

                        }).inject(th5);


                        var prefs = new UWA.Controls.Form({
                            fields: [

                                {
                                    type: "list",
                                    name: "My List",
                                    label: "Choose Tenant",
                                    value: "Value1",
                                    options: [
                                        {
                                            label: "Tenant 1",
                                            value: "Value1"
                                        },
                                        {
                                            label: "Tenant 2",
                                            value: "Value2"
                                        },

                                    ],
                                    value: "-Other- "
                                }
                            ],
                            events: {
                                onChange: function (callback, name, value) {

                                },

                                onSubmit: function (event, values) {
                                    cosole.log("send evnet")

                                }
                            }
                        }).inject(th6);


                        var theInput = document.getElementById('input1');
                        console.log(theInput)




                            function createNewEntry() {
                            console.log("in ADD ================")
                    i++;
                    var newRow = widget.createElement('tr', {
                        id: 'tr_' + i
                    }).inject(table);

                    var addtd1 = widget.createElement('td').inject(newRow)
                    var addtd2 = widget.createElement('td').inject(newRow)
                    var addtd3 = widget.createElement('td').inject(newRow)
                    var addtd4 = widget.createElement('td').inject(newRow)


                    var add1 = widget.createElement('input', {
                        id: 'input1_' + i
                    }).inject(addtd1);
                    var add2 = widget.createElement('input', {
                        id: 'input2_' + i
                    }).inject(addtd2);
                    var add3 = widget.createElement('input', {
                        id: 'input3_' + i
                    }).inject(addtd3);

                    var add4 = new UWA.Controls.Input.Button({
                        value: "-",
                        attributes: {
                            id: 'susBtn_' + i
                        },
                        events: {
                            onClick: function (e) {
                                console.log(e.target.getParents())
                                e.target.getParents()[1].remove()
                                i--

                            },

                        },

                    }).inject(addtd4);



                }






                            DataDragAndDrop.droppable(maindiv, {
                    drop: function (data) {

                        var jsondata = JSON.parse(data)
                        var objects = jsondata['data']['items']
                        for (var j = 0; j < objects.length; j++) {
                            createNewEntry();
                            var displayName = document.getElementById('input1_' + i);
                            var objectType = document.getElementById('input2_' + i);
                            var objectId = document.getElementById('input3_' + i);
                            displayName.value = objects[j]['displayName']
                            objectType.value = objects[j]['objectType']
                            objectId.value = objects[j]['objectId']
                        }







                    },

                    enter: function () {
                        console.log("drop1")
                    },
                    over: function () {
                        console.log("drop2")
                    },
                    leave: function () {
                        console.log("drop3")
                    },






                });


            //  UWA.Data.request('https://r1132100565133-eu1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dseng/dseng:EngItem/857FEB800000409060240CB90000C5DF', {
            //method: 'GET',
            // type: 'Json',
            //cache: 3600,
            // onComplete: MyWidget.dataProcessor,
            // onFailure: MyWidget.dataError
            //  });

        },

                       // dataProcessor: function (data) {
                            // do your data processing here
                           // console.log("bonour")
                       // },

                      //  dataError: function (error) {
                           // console.log("fadiit")
                            // do your data error here
                       // }







                    };
        widget.addEvent('onLoad', myWidget.onLoad);
        widget.addEvent('onRefresh', myWidget.onRefresh);
        widget.addEvent('onResize', myWidget.onResize);
                });

        }());
    </script>
</head>

<body>
</body>

</html>